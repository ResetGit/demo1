<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" >
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <script src="layui/layui.js" charset="utf-8"></script>
    <script src="layui/layui.all.js" charset="utf-8"></script>
    <script src="js/jquery.min.js"></script>
</head>
<body>
<div class="layui-form-item" style="text-align: center;">
    <a class="layui-btn" lay-submit="" lay-filter="demo1" href="javascript:edit(1)">修改资料</a>
    <a class="layui-btn" lay-submit="" lay-filter="demo2" href="javascript:edit(2)">修改密码</a>
    <a class="layui-btn" lay-submit="" lay-filter="demo3" href="javascript:edit(0)">个人中心</a>
</div>
<div id="windows1">
<form class="layui-form layui-form-pane" action="">
    <input type="hidden" name="sh_id" id="sh_id" autocomplete="off" class="layui-input" disabled="disabled">
    <div class="layui-form-item">
        <label class="layui-form-label">账号</label>
        <div class="layui-input-block">
            <input type="text" name="sh_name" id="sh_name" autocomplete="off"  class="layui-input" disabled="disabled">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">店名</label>
        <div class="layui-input-block">
            <input type="text" name="shopname" id="shopname" autocomplete="off"  class="layui-input"  disabled="disabled">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">手机号</label>
        <div class="layui-input-block">
            <input type="text" name="phone" id="phone" autocomplete="off"  class="layui-input"  disabled="disabled">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">微信appid</label>
        <div class="layui-input-block">
            <input type="text" name="appid" id="appid" autocomplete="off"  class="layui-input"  disabled="disabled">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">支付宝appid</label>
        <div class="layui-input-block">
            <input type="text" name="aliappid" id="aliappid" autocomplete="off"  class="layui-input"  disabled="disabled">
        </div>
    </div>
<!--    <div class="layui-form-item">-->
<!--        <label class="layui-form-label">appsecret</label>-->
<!--        <div class="layui-input-block">-->
<!--            <input type="text" name="appsecret" id="appsecret" autocomplete="off"  class="layui-input"  disabled="disabled">-->
<!--        </div>-->
<!--    </div>-->
</form>
</div>
<div id="windows2" style="display: none;">
    <form class="layui-form layui-form-pane" action="">
        <input type="hidden" name="sh_id" id="sh_id2" autocomplete="off" class="layui-input" disabled="disabled">
        <div class="layui-form-item">
            <label class="layui-form-label">店名</label>
            <div class="layui-input-block">
                <input type="text" name="shopname" id="shopname2" autocomplete="off"  class="layui-input" >
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">手机号</label>
            <div class="layui-input-block">
                <input type="text" name="phone" id="phone2" autocomplete="off"  class="layui-input"  disabled="disabled">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">微信appid</label>
            <div class="layui-input-block">
                <input type="text" name="appid" id="appid2" autocomplete="off"  class="layui-input"  >
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">支付宝appid</label>
            <div class="layui-input-block">
                <input type="text" name="aliappid" id="aliappid2" autocomplete="off"  class="layui-input"  >
            </div>
        </div>
        <div class="layui-form-item" style="text-align: center;">
            <a class="layui-btn" lay-submit="" lay-filter="demo1" onclick="save(1)">保存</a>
        </div>
    </form>
</div>
<div id="windows3" style="display: none;">
    <form class="layui-form layui-form-pane" action="" id="passwordform">
        <input type="hidden" name="sh_id" id="sh_id3" autocomplete="off" class="layui-input" disabled="disabled">
        <input type="hidden" name="sh_name" id="sh_name3" autocomplete="off" value="" class="layui-input" disabled="disabled">
        <div class="layui-form-item">
            <label class="layui-form-label">原密码</label>
            <div class="layui-input-block">
                <input type="password" name="sh_password" id="sh_password" autocomplete="off"  class="layui-input" >
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">新密码</label>
            <div class="layui-input-block">
                <input type="password" name="new_password" id="new_password" autocomplete="off"  class="layui-input" >
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">确认密码</label>
            <div class="layui-input-block">
                <input type="password" name="new_password2" id="new_password2" autocomplete="off"  class="layui-input"  >
            </div>
        </div>
        <div class="layui-form-item" style="text-align: center;">
            <a class="layui-btn" lay-submit="" lay-filter="demo1" onclick="save(2)">保存</a>
        </div>
    </form>
</div>
</body>
<script>
    $(function(){
        var token = sessionStorage.token;
        $.ajax({
            url: "user/loginGetSession",
            type: "post",
            data: {
                tokens:token
            },
            success(data){
                // console.log(data.data)
                $("#sh_name").val(data.data.name);
                $("#sh_name3").val(data.data.name);
                $("#phone").val(data.data.phone);
                $("#phone2").val(data.data.phone);
                $("#sh_id").val(data.data.id);
                $("#sh_id2").val(data.data.id);
                $("#sh_id3").val(data.data.id);
                // $("#shopname").val(data[0].shopname);
                // $("#shopname2").val(data[0].shopname);
                if(data[0].appid == null || data[0].appid ==""){
                    $("#appid").val("");
                    $("#appid2").val("");
                }else{
                    $("#appid").val(data[0].appid);
                    $("#appid2").val(data[0].appid);
                }
                if(data[0].aliappid == null || data[0].aliappid ==""){
                    $("#aliappid").val("");
                    $("#aliappid2").val("");
                }else{
                    $("#aliappid").val(data[0].aliappid);
                    $("#aliappid2").val(data[0].aliappid);
                }
            }
        })
        }
    )
    function edit(value){
        if(value == 1){
            $("#windows2").show();
            $("#windows1").hide();
            $("#windows3").hide();
        }else if(value == 2){
            $("#windows1").hide();
            $("#windows2").hide();
            $("#windows3").show();
        }else{
            $("#windows1").show();
            $("#windows2").hide();
            $("#windows3").hide();
        }
    }
    function save(value){
        if(value == 1){
            var data = {};
            data["sh_id"]=$("#sh_id3").val();
            data["shopname"]=$("#shopname").val();
            data["appid"]=$("#appid2").val();
            data["aliappid"]=$("#aliappid2").val();
            $.ajax({
                url:"editMeans",
                type:"post",
                dataType:"json",
                contentType: 'application/json;charset=UTF-8',
                data:JSON.stringify(data),
                success:function(suc){
                    if(suc ==1){
                        layer.msg("修改成功！");
                        window.parent.location.reload();
                    }else {
                        layer.msg("修改错误！");
                    }
                }
            })
        }else{
            if($("#new_password").val() != $("#new_password2").val()){
                layer.msg("确认密码与新密码不一致");
                return false;
            }
            var data = {};
            data["sh_id"]=$("#sh_id3").val();
            data["sh_name"]=$("#sh_name3").val();
            data["sh_password"]=$("#sh_password").val();
            data["new_password"]=$("#new_password").val();
            console.log(data)
            $.ajax({
                url:"user/editPassword",
                type:"post",
                dataType:"json",
                contentType: 'application/json;charset=UTF-8',
                data:JSON.stringify(data),
                success:function(suc){
                    console.log(suc)
                    if(suc ==1){
                        layer.msg("密码修改成功！");
                        window.parent.location.reload();
                    }else {
                        layer.msg("密码错误！");
                    }
                }
            })
        }
    }
</script>
</html>